<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Flugdaten Formular</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 12px; }
    input, select {
      width: 100%; padding: 8px; margin-top: 4px;
      font-size: 16px; box-sizing: border-box;
    }
    input[readonly] { background-color: #eee; }
    button {
      margin-top: 20px; padding: 10px; width: 100%;
      background-color: #007bff; color: white; border: none;
      font-size: 16px; border-radius: 5px; cursor: pointer;
    }
    #preview { max-width: 100%; margin-top: 10px; border: 1px solid #ccc; }
    .header { display: flex; justify-content: space-between; align-items: center; }
    .header h2 { margin: 0; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
</head>
<body>
  <div class="header">
    <h2>Flugdaten Formular</h2>
    <img src="Diebel Flug1.png" alt="Logo" style="height: 50px;" />
  </div>

  <form id="flugForm">
    <label>Vorname / First Name:
      <input type="text" id="vorname" required />
    </label>
    <label>Nachname / Last Name:
      <input type="text" id="nachname" required />
    </label>
    <label>Flugticket / Flight Ticket:
      <input type="file" id="bildInput" accept="image/*" required />
    </label>
    <img id="preview" src="" alt="Vorschau" />

    <label>Flugtyp / Flight Type:
      <input type="text" id="flugtyp" readonly />
    </label>
    <label>Datum / Date:
      <input type="date" id="datum" readonly />
    </label>
    <label>Abflug / Departure:
      <input type="time" id="abflug" readonly />
    </label>
    <label>Ankunft / Arrival:
      <input type="time" id="ankunft" readonly />
    </label>

    <button type="button" onclick="sendeMail()">ðŸ“§ E-Mail senden</button>
  </form>

  <script>
    const deutscheStaedte = ["Berlin", "Hamburg", "MÃ¼nchen", "Munich", "Frankfurt", "Cologne", "KÃ¶ln", "DÃ¼sseldorf", "Leipzig", "Stuttgart"];

    document.getElementById("bildInput").addEventListener("change", async function () {
      const file = this.files[0];
      if (!file) return;

      const preview = document.getElementById("preview");
      preview.src = URL.createObjectURL(file);

      const result = await Tesseract.recognize(file, 'eng+deu', { logger: m => console.log(m) });
      const text = result.data.text;
      console.log("Erkannter Text:", text);

      // FLUGTYP
      const from = text.match(/From\s+([A-Za-zÃ„Ã–ÃœÃ¤Ã¶Ã¼ \-]+)/i)?.[1]?.trim() ?? "";
      const to = text.match(/To\s+([A-Za-zÃ„Ã–ÃœÃ¤Ã¶Ã¼ \-]+)/i)?.[1]?.trim() ?? "";

      let flugtyp = "Unbekannt";
      if (deutscheStaedte.some(stadt => to.toLowerCase().includes(stadt.toLowerCase()))) {
        flugtyp = "Flug nach Arbeit";
      } else if (deutscheStaedte.some(stadt => from.toLowerCase().includes(stadt.toLowerCase()))) {
        flugtyp = "Flug nach Hause";
      }
      document.getElementById("flugtyp").value = flugtyp;

      // DATUM
      const datePattern = /(\d{1,2})[.\-/\s]?([A-ZÃ„Ã–Ãœa-zÃ¤Ã¶Ã¼]{3,})[.\-/\s]?(\d{2,4})/;
      const dateMatch = text.match(datePattern);
      if (dateMatch) {
        const [_, tag, monatRaw, jahrRaw] = dateMatch;
        const monate = {
          jan: "01", feb: "02", mar: "03", mÃ¤r: "03", apr: "04", may: "05", mai: "05",
          jun: "06", jul: "07", aug: "08", sep: "09", oct: "10", okt: "10", nov: "11", dec: "12", dez: "12"
        };
        const monat = monate[monatRaw.toLowerCase().slice(0, 3)] || "01";
        const jahr = jahrRaw.length === 2 ? "20" + jahrRaw : jahrRaw;
        const datum = `${jahr}-${monat}-${tag.padStart(2, "0")}`;
        document.getElementById("datum").value = datum;
      }

      // ZEITEN
      const zeiten = text.match(/\b\d{1,2}[:.]\d{2}\b/g);
      if (zeiten?.length >= 2) {
        const abflug = zeiten[0].replace(".", ":").padStart(5, "0");
        const ankunft = zeiten[1].replace(".", ":").padStart(5, "0");
        document.getElementById("abflug").value = abflug;
        document.getElementById("ankunft").value = ankunft;
      }
    });

    function sendeMail() {
      const empfaenger = "anwar.abosaad@diebel-spedition.de";
      const betreff = "Flugdaten";

      const text = `Hallo,

Hier sind die Flugdaten:

Vorname: ${document.getElementById("vorname").value}
Nachname: ${document.getElementById("nachname").value}
Flugtyp: ${document.getElementById("flugtyp").value}
Datum: ${document.getElementById("datum").value}
Abflug: ${document.getElementById("abflug").value}
Ankunft: ${document.getElementById("ankunft").value}

Viele GrÃ¼ÃŸe`;

      const mailtoLink = `mailto:${empfaenger}?subject=${encodeURIComponent(betreff)}&body=${encodeURIComponent(text)}`;
      window.location.href = mailtoLink;
    }
  </script>
</body>
</html>
