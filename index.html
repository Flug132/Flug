<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Flugdaten KI-Formular</title>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    label { display: block; margin-top: 10px; }
    input, select {
      width: 100%; padding: 8px; margin-top: 4px; box-sizing: border-box;
    }
    button {
      margin-top: 20px; padding: 10px; width: 100%;
      background-color: #007bff; color: white;
      border: none; font-size: 16px; border-radius: 5px;
    }
    #preview { margin-top: 10px; max-width: 100%; }
  </style>
</head>
<body>
  <h2>Flugdaten automatisch erkennen</h2>

  <label>ðŸ“¸ Flugticket hochladen:
    <input type="file" id="bild" accept="image/*" />
  </label>
  <img id="preview" />

  <form id="flugForm">
    <label>Vorname:
      <input type="text" id="name" />
    </label>
    <label>Nachname:
      <input type="text" id="nachname" />
    </label>
    <label>Flugtyp:
      <select id="flugtyp">
        <option value="Flug nach Hause">Flug nach Hause</option>
        <option value="Flug nach Arbeit">Flug nach Arbeit</option>
      </select>
    </label>
    <label>Flugnummer:
      <input type="text" id="flugnummer" />
    </label>
    <label>Datum:
      <input type="date" id="datum" />
    </label>
    <label>Abflug:
      <input type="time" id="abflug" />
    </label>
    <label>Ankunft:
      <input type="time" id="ankunft" />
    </label>
    <button type="button" onclick="sendeMail()">ðŸ“§ E-Mail erzeugen</button>
  </form>

  <script>
    const deutscheFlughÃ¤fen = ["FRA", "DUS", "MUC", "BER", "HAM", "CGN", "NUE", "STR", "LEJ", "HAJ", "TXL"];

    document.getElementById("bild").addEventListener("change", async function () {
      const file = this.files[0];
      if (!file) return;

      // Bild anzeigen
      const reader = new FileReader();
      reader.onload = function (e) {
        document.getElementById("preview").src = e.target.result;
      };
      reader.readAsDataURL(file);

      // OCR starten
      const result = await Tesseract.recognize(file, "eng+deu", {
        logger: m => console.log(m)
      });

      const text = result.data.text;
      console.log("Erkannt:", text);

      // Infos extrahieren
      const flugnummer = text.match(/[A-Z]{2}\d{2,4}/)?.[0] || "";
      const datum = text.match(/\d{4}[-\/\.]\d{2}[-\/\.]\d{2}/)?.[0] || "";
      const abflug = text.match(/\b\d{2}:\d{2}\b/)?.[0] || "";
      const ankunft = text.match(/\b\d{2}:\d{2}\b(?!.*\b\d{2}:\d{2}\b)/)?.[0] || "";
      const ziel = text.match(/To:\s*([A-Z]{3})/)?.[1] || "";

      // Flugtyp setzen
      let flugtyp = "Flug nach Hause";
      if (deutscheFlughÃ¤fen.includes(ziel)) {
        flugtyp = "Flug nach Arbeit";
      }

      // Felder befÃ¼llen
      document.getElementById("flugnummer").value = flugnummer;
      document.getElementById("datum").value = datum.replace(/[/\.]/g, "-");
      document.getElementById("abflug").value = abflug;
      document.getElementById("ankunft").value = ankunft;
      document.getElementById("flugtyp").value = flugtyp;
    });

    function sendeMail() {
      const name = document.getElementById("name").value;
      const nachname = document.getElementById("nachname").value;
      const flugtyp = document.getElementById("flugtyp").value;
      const flugnummer = document.getElementById("flugnummer").value;
      const datum = document.getElementById("datum").value;
      const abflug = document.getElementById("abflug").value;
      const ankunft = document.getElementById("ankunft").value;

      const empfaenger = "anwar.abosaad@diebel-spedition.de";
      const betreff = "Flugdaten";
      const text = `Hallo,

anbei ist mein Flug:

Name: ${name}
Nachname: ${nachname}
Flugtyp: ${flugtyp}
Flugnummer: ${flugnummer}
Datum: ${datum}
Abflug: ${abflug}
Ankunft: ${ankunft}

Viele GrÃ¼ÃŸe`;

      const mailtoLink = `mailto:${empfaenger}?subject=${encodeURIComponent(betreff)}&body=${encodeURIComponent(text)}`;
      window.location.href = mailtoLink;
    }
  </script>
</body>
</html>
